#!/usr/bin/env python3
from bs4 import BeautifulSoup
import requests
import json
import sys

version = sys.argv[1]
url = 'https://www.zabbix.com/br/security_advisories?version=' + version
cve_data = []

response = requests.get(url)
soup = BeautifulSoup(response.text, 'html.parser')
table = soup.find('table', class_='webinars-table')
rows = table.find_all('tr')[1:] 

for row in rows:
    cells = row.find_all('td')
    if len(cells) > 7:  
        cve_info = {
            '{#ZABBIXID}': cells[0].text.strip(),
            '{#CVENUMBER}': cells[1].text.strip(),
            '{#CVSSSCORE}': cells[2].text.strip(),
            '{#ZABBIXSEVERITY}': cells[3].text.strip(),
            '{#COMPONENTS}': cells[5].text.strip(),
            '{#SYNOPSIS}': cells[6].text.strip(),
            '{#DESCRIPTION}': cells[7].text.strip()
        }
        cve_data.append(cve_info)

filtered_data = [entry for entry in cve_data if "ZBV" in entry.get("{#ZABBIXID}", "")]
filtered_json = json.dumps(filtered_data, indent=4)
print(filtered_json)
